<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="zh" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>LangChain 与 LLM 的结合使用详解 - Chico Gong’s Tech Blog</title>
<meta name="description" content="详细介绍 LangChain 与 LLM 的结合方式、核心组件以及常见应用场景，帮助开发者构建强大的AI应用。">


  <meta name="author" content="Chico Gong">
  
  <meta property="article:author" content="Chico Gong">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="zh_Hans">
<meta property="og:site_name" content="Chico Gong's Tech Blog">
<meta property="og:title" content="LangChain 与 LLM 的结合使用详解">
<meta property="og:url" content="http://0.0.0.0:4000/ai-technology/langchain-llm-integration-guide/">


  <meta property="og:description" content="详细介绍 LangChain 与 LLM 的结合方式、核心组件以及常见应用场景，帮助开发者构建强大的AI应用。">



  <meta property="og:image" content="http://0.0.0.0:4000/assets/images/langchain-llm-teaser.jpg">





  <meta property="article:published_time" content="2024-12-28T00:00:00+08:00">






<link rel="canonical" href="http://0.0.0.0:4000/ai-technology/langchain-llm-integration-guide/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Chico Gong",
      "url": "http://0.0.0.0:4000/",
      "sameAs": ["https://github.com/chicogong","https://twitter.com/your-twitter"]
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Chico Gong's Tech Blog Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- 自定义头部内容 -->

<!-- Mermaid 图表支持 -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
<script>
  // 等待DOM加载完成后初始化Mermaid
  document.addEventListener('DOMContentLoaded', function() {
    mermaid.initialize({ 
      startOnLoad: true,
      theme: 'base',
      themeVariables: {
        primaryColor: '#3b82f6',
        primaryTextColor: '#1f2937',
        primaryBorderColor: '#3b82f6',
        lineColor: '#6b7280',
        sectionBkgColor: '#f9fafb',
        altSectionBkgColor: '#ffffff',
        gridColor: '#e5e7eb',
        secondaryColor: '#8b5cf6',
        tertiaryColor: '#06b6d4',
        background: '#ffffff',
        mainBkg: '#f9fafb',
        secondBkg: '#ffffff',
        tertiaryBkg: '#f3f4f6'
      },
      flowchart: {
        useMaxWidth: true,
        htmlLabels: true,
        curve: 'basis'
      },
      sequence: {
        useMaxWidth: true,
        wrap: true
      },
      gantt: {
        useMaxWidth: true
      }
    });
    
    // 手动渲染页面中的所有mermaid图表
    const mermaidElements = document.querySelectorAll('.language-mermaid, .mermaid');
    mermaidElements.forEach(function(element, index) {
      const graphDefinition = element.textContent || element.innerText;
      const graphId = 'mermaid-' + index;
      
      // 创建新的div来渲染图表
      const graphDiv = document.createElement('div');
      graphDiv.className = 'mermaid';
      graphDiv.id = graphId;
      
      // 渲染图表
      mermaid.render(graphId + '-svg', graphDefinition).then(function(result) {
        graphDiv.innerHTML = result.svg;
        element.parentNode.replaceChild(graphDiv, element);
      }).catch(function(error) {
        console.error('Mermaid rendering error:', error);
        element.innerHTML = '<p style="color: red;">图表渲染失败: ' + error.message + '</p>';
      });
    });
  });
</script>

<!-- 字体预加载优化 -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<!-- 性能优化 -->
<meta name="theme-color" content="#3b82f6">
<meta name="msapplication-TileColor" content="#3b82f6">

<!-- 自定义样式增强 */
<style>
  /* 页面加载动画 */
  .page-loading {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    opacity: 1;
    transition: opacity 0.5s ease;
  }
  
  .page-loading.fade-out {
    opacity: 0;
    pointer-events: none;
  }
  
  .loading-spinner {
    width: 50px;
    height: 50px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-top: 3px solid white;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  /* Mermaid 图表优化 */
  .mermaid {
    text-align: center;
    margin: 2rem 0;
    background: #ffffff;
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07), 0 2px 4px rgba(0, 0, 0, 0.06);
    border: 1px solid #e5e7eb;
    overflow-x: auto;
  }
  
  .mermaid .node rect,
  .mermaid .node circle,
  .mermaid .node ellipse,
  .mermaid .node polygon {
    fill: #f9fafb;
    stroke: #3b82f6;
    stroke-width: 2px;
  }
  
  .mermaid .edgePath .path {
    stroke: #6b7280;
    stroke-width: 2px;
  }
  
  .mermaid .cluster rect {
    fill: rgba(59, 130, 246, 0.1);
    stroke: #3b82f6;
    stroke-width: 1px;
  }
  
  .mermaid .nodeLabel,
  .mermaid .edgeLabel {
    font-family: 'Inter', 'Noto Sans SC', sans-serif;
    font-size: 14px;
    color: #1f2937;
  }
  
  .mermaid svg {
    max-width: 100%;
    height: auto;
  }
  
  /* 修复代码块中的mermaid */
  .language-mermaid {
    display: none;
  }
  
  /* 代码高亮主题优化 */
  .highlight {
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07), 0 2px 4px rgba(0, 0, 0, 0.06);
  }
  
  .highlight pre {
    margin: 0;
    border-radius: 0;
  }
  
  /* 平滑滚动优化 */
  html {
    scroll-behavior: smooth;
  }
  
  /* 选择文本样式 */
  ::selection {
    background: rgba(59, 130, 246, 0.2);
    color: #1f2937;
  }
  
  ::-moz-selection {
    background: rgba(59, 130, 246, 0.2);
    color: #1f2937;
  }
</style>

<!-- 页面加载优化脚本 -->
<script>
  // 页面加载完成后隐藏加载动画
  window.addEventListener('load', function() {
    const loader = document.querySelector('.page-loading');
    if (loader) {
      loader.classList.add('fade-out');
      setTimeout(() => {
        loader.remove();
      }, 500);
    }
  });
  
  // 平滑滚动到锚点
  document.addEventListener('DOMContentLoaded', function() {
    const links = document.querySelectorAll('a[href^="#"]');
    links.forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const targetId = this.getAttribute('href').substring(1);
        const targetElement = document.getElementById(targetId);
        if (targetElement) {
          targetElement.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });
  });
</script> 
  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Chico Gong's Tech Blog
          <span class="site-subtitle">Conversational AI & Real-time Communication</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/" title="返回主页">首页</a>
            </li><li class="masthead__menu-item">
              <a href="/about/" title="了解更多关于我的信息">关于我</a>
            </li><li class="masthead__menu-item">
              <a href="/posts/" title="浏览所有文章">文章</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/" title="按分类浏览文章">分类</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/" title="按标签浏览文章">标签</a>
            </li><li class="masthead__menu-item">
              <a href="/year-archive/" title="按年份浏览文章">归档</a>
            </li><li class="masthead__menu-item">
              <a href="/projects/" title="查看我的开源项目">项目</a>
            </li><li class="masthead__menu-item">
              <a href="/contact/" title="联系方式和社交媒体">联系</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="http://0.0.0.0:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#ai-technology" itemprop="item"><span itemprop="name">Ai technology</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">LangChain 与 LLM 的结合使用详解</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="https://github.com/chicogong.png" alt="Chico Gong" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Chico Gong</h3>
    
    
      <div class="author__bio" itemprop="description">
        <table>
  <tbody>
    <tr>
      <td>🤖 Conversational AI Enthusiast</td>
      <td>📞 Real-time Communication Developer</td>
      <td>⚡ Building next-gen voice interaction systems</td>
    </tr>
  </tbody>
</table>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Shanghai, China</span>
        </li>
      

      
        
          
            <li><a href="https://github.com/chicogong" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="mailto:chicogong@tencent.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
            <li><a href="https://linkedin.com/in/chicogong" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
      

      

      
        <li>
          <a href="mailto:chicogong@tencent.com">
            <meta itemprop="email" content="chicogong@tencent.com" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span>
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <a href="/"><span class="nav__sub-title">首页</span></a>
        

        
      </li>
    
      <li>
        
          <a href="/about/"><span class="nav__sub-title">关于我</span></a>
        

        
      </li>
    
      <li>
        
          <a href="/posts/"><span class="nav__sub-title">文章</span></a>
        

        
      </li>
    
      <li>
        
          <a href="/categories/"><span class="nav__sub-title">分类</span></a>
        

        
      </li>
    
      <li>
        
          <a href="/tags/"><span class="nav__sub-title">标签</span></a>
        

        
      </li>
    
      <li>
        
          <a href="/year-archive/"><span class="nav__sub-title">归档</span></a>
        

        
      </li>
    
      <li>
        
          <a href="/projects/"><span class="nav__sub-title">项目</span></a>
        

        
      </li>
    
      <li>
        
          <a href="/contact/"><span class="nav__sub-title">联系</span></a>
        

        
      </li>
    
  </ul>
</nav>

    
  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="LangChain 与 LLM 的结合使用详解">
    <meta itemprop="description" content="详细介绍 LangChain 与 LLM 的结合方式、核心组件以及常见应用场景，帮助开发者构建强大的AI应用。">
    <meta itemprop="datePublished" content="2024-12-28T00:00:00+08:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">LangChain 与 LLM 的结合使用详解
</h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2024-12-28T00:00:00+08:00">December 28, 2024</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          8 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-fas fa-list"></i> 目录</h4></header>
              <ul class="toc__menu"><li><a href="#langchain-核心理念">LangChain 核心理念</a></li><li><a href="#langchain-架构概览">LangChain 架构概览</a></li><li><a href="#langchain-核心组件">LangChain 核心组件</a><ul><li><a href="#1-模型集成-models">1. 模型集成 (Models)</a></li><li><a href="#2-提示工程-prompts">2. 提示工程 (Prompts)</a></li><li><a href="#3-链-chains">3. 链 (Chains)</a></li><li><a href="#4-记忆-memory">4. 记忆 (Memory)</a></li><li><a href="#5-检索增强生成-rag">5. 检索增强生成 (RAG)</a></li><li><a href="#6-代理-agents">6. 代理 (Agents)</a></li></ul></li><li><a href="#langchain-应用场景">LangChain 应用场景</a><ul><li><a href="#1-智能问答系统">1. 智能问答系统</a></li><li><a href="#2-多轮对话机器人">2. 多轮对话机器人</a></li><li><a href="#3-结构化数据提取">3. 结构化数据提取</a></li><li><a href="#4-工作流自动化">4. 工作流自动化</a></li></ul></li><li><a href="#高级模式与最佳实践">高级模式与最佳实践</a><ul><li><a href="#1-提示工程最佳实践">1. 提示工程最佳实践</a></li><li><a href="#2-自定义链">2. 自定义链</a></li><li><a href="#3-批处理优化">3. 批处理优化</a></li><li><a href="#4-rag高级技术">4. RAG高级技术</a></li></ul></li><li><a href="#性能优化与部署">性能优化与部署</a><ul><li><a href="#1-缓存策略">1. 缓存策略</a></li><li><a href="#2-流式输出">2. 流式输出</a></li><li><a href="#3-错误处理与重试">3. 错误处理与重试</a></li></ul></li><li><a href="#总结">总结</a></li></ul>

            </nav>
          </aside>
        
        <p>LangChain 是一个强大的框架，专为开发基于大语言模型(LLM)的应用而设计。本文将详细介绍 LangChain 与 LLM 的结合方式、核心组件以及常见应用场景。</p>

<h2 id="langchain-核心理念">LangChain 核心理念</h2>

<p>LangChain 的核心理念是将 LLM 与外部资源(如数据源、工具、API等)连接起来，构建更强大、更实用的 AI 应用。它提供了一系列抽象和工具，使开发者能够轻松地:</p>

<ul>
  <li>与各种 LLM 服务进行标准化交互</li>
  <li>构建复杂的处理流程</li>
  <li>使 LLM 能够访问外部信息和工具</li>
  <li>实现记忆和状态管理</li>
</ul>

<h2 id="langchain-架构概览">LangChain 架构概览</h2>

<pre><code class="language-mermaid">flowchart TB
    subgraph "应用层"
        A1["智能问答系统"]
        A2["对话机器人"]
        A3["文档分析工具"]
        A4["代码助手"]
    end
    
    subgraph "LangChain核心层"
        B1["链 Chains"]
        B2["代理 Agents"]
        B3["记忆 Memory"]
        B4["工具 Tools"]
    end
    
    subgraph "模型层"
        C1["OpenAI GPT"]
        C2["Anthropic Claude"]
        C3["Google PaLM"]
        C4["本地模型"]
    end
    
    subgraph "数据层"
        D1["向量数据库"]
        D2["文档存储"]
        D3["API接口"]
        D4["知识库"]
    end
    
    A1 --&gt; B1
    A2 --&gt; B2
    A3 --&gt; B3
    A4 --&gt; B4
    B1 --&gt; C1
    B2 --&gt; C2
    B3 --&gt; C3
    B4 --&gt; C4
    B1 --&gt; D1
    B2 --&gt; D2
    B3 --&gt; D3
    B4 --&gt; D4
</code></pre>

<h2 id="langchain-核心组件">LangChain 核心组件</h2>

<h3 id="1-模型集成-models">1. 模型集成 (Models)</h3>

<p>LangChain 支持多种类型的模型，提供统一的接口：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="c1">// 基础 LLM 使用</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">OpenAI</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@langchain/openai</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">llm</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpenAI</span><span class="p">({</span>
  <span class="na">temperature</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
  <span class="na">model</span><span class="p">:</span> <span class="dl">"</span><span class="s2">gpt-3.5-turbo</span><span class="dl">"</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">llm</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="dl">"</span><span class="s2">什么是人工智能？</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>

<span class="c1">// 聊天模型使用</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ChatOpenAI</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@langchain/openai</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">HumanMessage</span><span class="p">,</span> <span class="nx">SystemMessage</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@langchain/core/messages</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">chatModel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ChatOpenAI</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">messages</span> <span class="o">=</span> <span class="p">[</span>
  <span class="k">new</span> <span class="nx">SystemMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">你是一位人工智能专家</span><span class="dl">"</span><span class="p">),</span>
  <span class="k">new</span> <span class="nx">HumanMessage</span><span class="p">(</span><span class="dl">"</span><span class="s2">简单解释一下神经网络的工作原理</span><span class="dl">"</span><span class="p">)</span>
<span class="p">];</span>

<span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">chatModel</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="nx">messages</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2-提示工程-prompts">2. 提示工程 (Prompts)</h3>

<p>提供了管理和优化提示的工具：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">PromptTemplate</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@langchain/core/prompts</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// 创建带有变量的提示模板</span>
<span class="kd">const</span> <span class="nx">promptTemplate</span> <span class="o">=</span> <span class="nx">PromptTemplate</span><span class="p">.</span><span class="nx">fromTemplate</span><span class="p">(</span>
  <span class="dl">"</span><span class="s2">请为一家{industry}公司写一个{length}字的{document_type}</span><span class="dl">"</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="nx">formattedPrompt</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">promptTemplate</span><span class="p">.</span><span class="nx">format</span><span class="p">({</span>
  <span class="na">industry</span><span class="p">:</span> <span class="dl">"</span><span class="s2">人工智能</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">length</span><span class="p">:</span> <span class="dl">"</span><span class="s2">500</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">document_type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">公司简介</span><span class="dl">"</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">llm</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="nx">formattedPrompt</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="3-链-chains">3. 链 (Chains)</h3>

<p>链是 LangChain 的核心概念，允许组合多个组件：</p>

<pre><code class="language-mermaid">flowchart LR
    A["用户输入"] --&gt; B["提示模板"]
    B --&gt; C["LLM处理"]
    C --&gt; D["输出解析"]
    D --&gt; E["结果返回"]
    
    subgraph "简单链"
        B
        C
        D
    end
    
    subgraph "复杂链"
        F["步骤1"] --&gt; G["步骤2"]
        G --&gt; H["步骤3"]
        H --&gt; I["最终输出"]
    end
</code></pre>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">LLMChain</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">langchain/chains</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// 简单的LLM链</span>
<span class="kd">const</span> <span class="nx">chain</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">LLMChain</span><span class="p">({</span>
  <span class="na">llm</span><span class="p">:</span> <span class="k">new</span> <span class="nx">OpenAI</span><span class="p">({</span> <span class="na">temperature</span><span class="p">:</span> <span class="mf">0.7</span> <span class="p">}),</span>
  <span class="na">prompt</span><span class="p">:</span> <span class="nx">PromptTemplate</span><span class="p">.</span><span class="nx">fromTemplate</span><span class="p">(</span><span class="dl">"</span><span class="s2">解释{concept}，用简单的语言</span><span class="dl">"</span><span class="p">)</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">chain</span><span class="p">.</span><span class="nx">invoke</span><span class="p">({</span> <span class="na">concept</span><span class="p">:</span> <span class="dl">"</span><span class="s2">量子计算</span><span class="dl">"</span> <span class="p">});</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>

<span class="c1">// 顺序链 - 处理多步骤任务</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">SequentialChain</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">langchain/chains</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">topicChain</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">LLMChain</span><span class="p">({</span>
  <span class="nx">llm</span><span class="p">,</span>
  <span class="na">prompt</span><span class="p">:</span> <span class="nx">PromptTemplate</span><span class="p">.</span><span class="nx">fromTemplate</span><span class="p">(</span><span class="dl">"</span><span class="s2">生成一个关于{subject}的研究主题</span><span class="dl">"</span><span class="p">),</span>
  <span class="na">outputKey</span><span class="p">:</span> <span class="dl">"</span><span class="s2">topic</span><span class="dl">"</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">outlineChain</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">LLMChain</span><span class="p">({</span>
  <span class="nx">llm</span><span class="p">,</span>
  <span class="na">prompt</span><span class="p">:</span> <span class="nx">PromptTemplate</span><span class="p">.</span><span class="nx">fromTemplate</span><span class="p">(</span><span class="dl">"</span><span class="s2">为研究主题'{topic}'创建一个大纲</span><span class="dl">"</span><span class="p">),</span>
  <span class="na">outputKey</span><span class="p">:</span> <span class="dl">"</span><span class="s2">outline</span><span class="dl">"</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">sequentialChain</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SequentialChain</span><span class="p">({</span>
  <span class="na">chains</span><span class="p">:</span> <span class="p">[</span><span class="nx">topicChain</span><span class="p">,</span> <span class="nx">outlineChain</span><span class="p">],</span>
  <span class="na">inputVariables</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">subject</span><span class="dl">"</span><span class="p">],</span>
  <span class="na">outputVariables</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">topic</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">outline</span><span class="dl">"</span><span class="p">]</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">sequentialChain</span><span class="p">.</span><span class="nx">invoke</span><span class="p">({</span> <span class="na">subject</span><span class="p">:</span> <span class="dl">"</span><span class="s2">气候变化</span><span class="dl">"</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="4-记忆-memory">4. 记忆 (Memory)</h3>

<p>实现对话历史和上下文管理：</p>

<pre><code class="language-mermaid">sequenceDiagram
    participant User as 用户
    participant Chain as 对话链
    participant Memory as 记忆组件
    participant LLM as 大语言模型
    
    User-&gt;&gt;Chain: 第一个问题
    Chain-&gt;&gt;Memory: 存储对话
    Chain-&gt;&gt;LLM: 处理问题
    LLM-&gt;&gt;Chain: 返回回答
    Chain-&gt;&gt;User: 显示回答
    
    User-&gt;&gt;Chain: 后续问题
    Chain-&gt;&gt;Memory: 获取历史对话
    Memory-&gt;&gt;Chain: 返回上下文
    Chain-&gt;&gt;LLM: 带上下文处理
    LLM-&gt;&gt;Chain: 上下文感知回答
    Chain-&gt;&gt;User: 显示回答
</code></pre>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">ConversationChain</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">langchain/chains</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">BufferMemory</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">langchain/memory</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">memory</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BufferMemory</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">conversation</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConversationChain</span><span class="p">({</span>
  <span class="na">llm</span><span class="p">:</span> <span class="k">new</span> <span class="nx">ChatOpenAI</span><span class="p">(),</span>
  <span class="nx">memory</span>
<span class="p">});</span>

<span class="c1">// 第一轮对话</span>
<span class="kd">const</span> <span class="nx">response1</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">conversation</span><span class="p">.</span><span class="nx">invoke</span><span class="p">({</span> <span class="na">input</span><span class="p">:</span> <span class="dl">"</span><span class="s2">我叫张三</span><span class="dl">"</span> <span class="p">});</span>

<span class="c1">// 第二轮对话 - 模型会记住用户名</span>
<span class="kd">const</span> <span class="nx">response2</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">conversation</span><span class="p">.</span><span class="nx">invoke</span><span class="p">({</span> <span class="na">input</span><span class="p">:</span> <span class="dl">"</span><span class="s2">你还记得我是谁吗？</span><span class="dl">"</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="5-检索增强生成-rag">5. 检索增强生成 (RAG)</h3>

<p>将 LLM 与外部知识库结合：</p>

<pre><code class="language-mermaid">flowchart TB
    A["文档集合"] --&gt; B["文档分割"]
    B --&gt; C["向量化"]
    C --&gt; D["向量存储"]
    
    E["用户查询"] --&gt; F["查询向量化"]
    F --&gt; G["相似度搜索"]
    D --&gt; G
    G --&gt; H["检索相关文档"]
    H --&gt; I["构建增强提示"]
    I --&gt; J["LLM生成回答"]
    
    style D fill:#e1f5fe
    style J fill:#e8f5e8
</code></pre>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">TextLoader</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">langchain/document_loaders/fs/text</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">RecursiveCharacterTextSplitter</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">langchain/text_splitter</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">OpenAIEmbeddings</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@langchain/openai</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">HNSWLib</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@langchain/community/vectorstores/hnswlib</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">RetrievalQAChain</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">langchain/chains</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// 加载文档</span>
<span class="kd">const</span> <span class="nx">loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TextLoader</span><span class="p">(</span><span class="dl">"</span><span class="s2">./documents/data.txt</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">docs</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">loader</span><span class="p">.</span><span class="nx">load</span><span class="p">();</span>

<span class="c1">// 分割文档</span>
<span class="kd">const</span> <span class="nx">textSplitter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RecursiveCharacterTextSplitter</span><span class="p">({</span>
  <span class="na">chunkSize</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
  <span class="na">chunkOverlap</span><span class="p">:</span> <span class="mi">200</span>
<span class="p">});</span>
<span class="kd">const</span> <span class="nx">splitDocs</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">textSplitter</span><span class="p">.</span><span class="nx">splitDocuments</span><span class="p">(</span><span class="nx">docs</span><span class="p">);</span>

<span class="c1">// 创建向量存储</span>
<span class="kd">const</span> <span class="nx">embeddings</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpenAIEmbeddings</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">vectorStore</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">HNSWLib</span><span class="p">.</span><span class="nx">fromDocuments</span><span class="p">(</span><span class="nx">splitDocs</span><span class="p">,</span> <span class="nx">embeddings</span><span class="p">);</span>

<span class="c1">// 创建问答链</span>
<span class="kd">const</span> <span class="nx">qa</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RetrievalQAChain</span><span class="p">({</span>
  <span class="na">combineDocumentsChain</span><span class="p">:</span> <span class="nx">loadQAStuffChain</span><span class="p">(</span><span class="k">new</span> <span class="nx">OpenAI</span><span class="p">()),</span>
  <span class="na">retriever</span><span class="p">:</span> <span class="nx">vectorStore</span><span class="p">.</span><span class="nx">asRetriever</span><span class="p">()</span>
<span class="p">});</span>

<span class="c1">// 提问</span>
<span class="kd">const</span> <span class="nx">answer</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">qa</span><span class="p">.</span><span class="nx">invoke</span><span class="p">({</span> <span class="na">query</span><span class="p">:</span> <span class="dl">"</span><span class="s2">文档中提到了哪些关键概念？</span><span class="dl">"</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="6-代理-agents">6. 代理 (Agents)</h3>

<p>赋予 LLM 使用工具和执行任务的能力：</p>

<pre><code class="language-mermaid">flowchart TD
    A["用户任务"] --&gt; B["代理分析"]
    B --&gt; C{"选择工具"}
    
    C --&gt;|"计算需求"| D["计算器工具"]
    C --&gt;|"搜索需求"| E["搜索工具"]
    C --&gt;|"API调用"| F["API工具"]
    C --&gt;|"文件操作"| G["文件工具"]
    
    D --&gt; H["执行并获取结果"]
    E --&gt; H
    F --&gt; H
    G --&gt; H
    
    H --&gt; I{"任务完成?"}
    I --&gt;|"否"| C
    I --&gt;|"是"| J["返回最终结果"]
</code></pre>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">initializeAgentExecutorWithOptions</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">langchain/agents</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">DynamicTool</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@langchain/core/tools</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Calculator</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">langchain/tools/calculator</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// 定义工具</span>
<span class="kd">const</span> <span class="nx">tools</span> <span class="o">=</span> <span class="p">[</span>
  <span class="k">new</span> <span class="nx">Calculator</span><span class="p">(),</span>
  <span class="k">new</span> <span class="nx">DynamicTool</span><span class="p">({</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">天气查询</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">description</span><span class="p">:</span> <span class="dl">"</span><span class="s2">获取指定城市的天气信息</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">func</span><span class="p">:</span> <span class="k">async</span> <span class="p">(</span><span class="nx">city</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// 这里可以调用实际的天气API</span>
      <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="nx">city</span><span class="p">}</span><span class="s2">今天晴天，温度22-28度`</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">})</span>
<span class="p">];</span>

<span class="c1">// 创建代理</span>
<span class="kd">const</span> <span class="nx">executor</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">initializeAgentExecutorWithOptions</span><span class="p">(</span>
  <span class="nx">tools</span><span class="p">,</span>
  <span class="k">new</span> <span class="nx">ChatOpenAI</span><span class="p">({</span> <span class="na">temperature</span><span class="p">:</span> <span class="mi">0</span> <span class="p">}),</span>
  <span class="p">{</span>
    <span class="na">agentType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">chat-conversational-react-description</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">verbose</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="c1">// 执行任务</span>
<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">executor</span><span class="p">.</span><span class="nx">invoke</span><span class="p">({</span>
  <span class="na">input</span><span class="p">:</span> <span class="dl">"</span><span class="s2">北京今天天气怎么样？然后计算 (24+28)/2 是多少？</span><span class="dl">"</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="langchain-应用场景">LangChain 应用场景</h2>

<h3 id="1-智能问答系统">1. 智能问答系统</h3>

<p>结合 RAG 技术构建能够回答特定领域问题的系统：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="c1">// 构建文档问答系统</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">PDFLoader</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">langchain/document_loaders/fs/pdf</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">OpenAIEmbeddings</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@langchain/openai</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Chroma</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@langchain/community/vectorstores/chroma</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">RetrievalQAChain</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">langchain/chains</span><span class="dl">"</span><span class="p">;</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">createQASystem</span><span class="p">(</span><span class="nx">docsPath</span><span class="p">,</span> <span class="nx">question</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 加载PDF文件</span>
  <span class="kd">const</span> <span class="nx">loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDFLoader</span><span class="p">(</span><span class="nx">docsPath</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">docs</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">loader</span><span class="p">.</span><span class="nx">load</span><span class="p">();</span>
  
  <span class="c1">// 创建向量存储</span>
  <span class="kd">const</span> <span class="nx">vectorStore</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Chroma</span><span class="p">.</span><span class="nx">fromDocuments</span><span class="p">(</span>
    <span class="nx">docs</span><span class="p">,</span> 
    <span class="k">new</span> <span class="nx">OpenAIEmbeddings</span><span class="p">()</span>
  <span class="p">);</span>
  
  <span class="c1">// 创建问答链</span>
  <span class="kd">const</span> <span class="nx">qa</span> <span class="o">=</span> <span class="nx">RetrievalQAChain</span><span class="p">.</span><span class="nx">fromLLM</span><span class="p">(</span>
    <span class="k">new</span> <span class="nx">ChatOpenAI</span><span class="p">({</span> <span class="na">modelName</span><span class="p">:</span> <span class="dl">"</span><span class="s2">gpt-4</span><span class="dl">"</span> <span class="p">}),</span>
    <span class="nx">vectorStore</span><span class="p">.</span><span class="nx">asRetriever</span><span class="p">()</span>
  <span class="p">);</span>
  
  <span class="c1">// 获取答案</span>
  <span class="k">return</span> <span class="k">await</span> <span class="nx">qa</span><span class="p">.</span><span class="nx">invoke</span><span class="p">({</span> <span class="na">query</span><span class="p">:</span> <span class="nx">question</span> <span class="p">});</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2-多轮对话机器人">2. 多轮对话机器人</h3>

<p>使用记忆组件构建能够维持上下文的聊天机器人：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">ChatOpenAI</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@langchain/openai</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ConversationChain</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">langchain/chains</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">BufferWindowMemory</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">langchain/memory</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ChatPromptTemplate</span><span class="p">,</span> <span class="nx">MessagesPlaceholder</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@langchain/core/prompts</span><span class="dl">"</span><span class="p">;</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">createChatbot</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// 创建提示模板</span>
  <span class="kd">const</span> <span class="nx">chatPrompt</span> <span class="o">=</span> <span class="nx">ChatPromptTemplate</span><span class="p">.</span><span class="nx">fromMessages</span><span class="p">([</span>
    <span class="p">[</span><span class="dl">"</span><span class="s2">system</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">你是一个专业的客服助手，负责解答用户关于产品的问题。</span><span class="dl">"</span><span class="p">],</span>
    <span class="k">new</span> <span class="nx">MessagesPlaceholder</span><span class="p">(</span><span class="dl">"</span><span class="s2">history</span><span class="dl">"</span><span class="p">),</span>
    <span class="p">[</span><span class="dl">"</span><span class="s2">human</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">{input}</span><span class="dl">"</span><span class="p">]</span>
  <span class="p">]);</span>
  
  <span class="c1">// 创建记忆组件</span>
  <span class="kd">const</span> <span class="nx">memory</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BufferWindowMemory</span><span class="p">({</span>
    <span class="na">memoryKey</span><span class="p">:</span> <span class="dl">"</span><span class="s2">history</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">k</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="na">returnMessages</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">});</span>
  
  <span class="c1">// 创建对话链</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nx">ConversationChain</span><span class="p">({</span>
    <span class="na">llm</span><span class="p">:</span> <span class="k">new</span> <span class="nx">ChatOpenAI</span><span class="p">(),</span>
    <span class="na">memory</span><span class="p">:</span> <span class="nx">memory</span><span class="p">,</span>
    <span class="na">prompt</span><span class="p">:</span> <span class="nx">chatPrompt</span>
  <span class="p">});</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="3-结构化数据提取">3. 结构化数据提取</h3>

<p>从非结构化文本中提取结构化信息：</p>

<pre><code class="language-mermaid">flowchart LR
    A[非结构化文本] --&gt; B[LLM分析]
    B --&gt; C[结构化输出解析]
    C --&gt; D[验证和格式化]
    D --&gt; E[JSON/数据库存储]
    
    subgraph "提取过程"
        F[实体识别]
        G[关系提取]
        H[属性提取]
    end
    
    B --&gt; F &amp; G &amp; H
    F &amp; G &amp; H --&gt; C
</code></pre>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">OpenAI</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@langchain/openai</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">StructuredOutputParser</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">langchain/output_parsers</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">PromptTemplate</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@langchain/core/prompts</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">z</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">zod</span><span class="dl">"</span><span class="p">;</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">extractStructuredData</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 定义输出结构</span>
  <span class="kd">const</span> <span class="nx">parser</span> <span class="o">=</span> <span class="nx">StructuredOutputParser</span><span class="p">.</span><span class="nx">fromZodSchema</span><span class="p">(</span>
    <span class="nx">z</span><span class="p">.</span><span class="nx">object</span><span class="p">({</span>
      <span class="na">people</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="nx">array</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">object</span><span class="p">({</span>
        <span class="na">name</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="nx">string</span><span class="p">().</span><span class="nx">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">人物姓名</span><span class="dl">"</span><span class="p">),</span>
        <span class="na">age</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="nx">number</span><span class="p">().</span><span class="nx">optional</span><span class="p">().</span><span class="nx">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">人物年龄</span><span class="dl">"</span><span class="p">),</span>
        <span class="na">occupation</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="nx">string</span><span class="p">().</span><span class="nx">optional</span><span class="p">().</span><span class="nx">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">职业</span><span class="dl">"</span><span class="p">)</span>
      <span class="p">})),</span>
      <span class="na">locations</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="nx">array</span><span class="p">(</span><span class="nx">z</span><span class="p">.</span><span class="nx">string</span><span class="p">()).</span><span class="nx">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">文本中提到的地点</span><span class="dl">"</span><span class="p">),</span>
      <span class="na">summary</span><span class="p">:</span> <span class="nx">z</span><span class="p">.</span><span class="nx">string</span><span class="p">().</span><span class="nx">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">文本的简要总结</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">);</span>
  
  <span class="c1">// 创建提示模板</span>
  <span class="kd">const</span> <span class="nx">prompt</span> <span class="o">=</span> <span class="nx">PromptTemplate</span><span class="p">.</span><span class="nx">fromTemplate</span><span class="p">(</span>
    <span class="s2">`从以下文本中提取关键信息，并按照指定格式输出。
    
    文本: {text}
    
    {format_instructions}
    `</span>
  <span class="p">);</span>
  
  <span class="c1">// 格式说明</span>
  <span class="kd">const</span> <span class="nx">formatInstructions</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">getFormatInstructions</span><span class="p">();</span>
  
  <span class="c1">// 生成完整提示</span>
  <span class="kd">const</span> <span class="nx">input</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">prompt</span><span class="p">.</span><span class="nx">format</span><span class="p">({</span>
    <span class="na">text</span><span class="p">:</span> <span class="nx">text</span><span class="p">,</span>
    <span class="na">format_instructions</span><span class="p">:</span> <span class="nx">formatInstructions</span>
  <span class="p">});</span>
  
  <span class="c1">// 获取LLM响应</span>
  <span class="kd">const</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpenAI</span><span class="p">({</span> <span class="na">temperature</span><span class="p">:</span> <span class="mi">0</span> <span class="p">});</span>
  <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">model</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
  
  <span class="c1">// 解析结果</span>
  <span class="k">return</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="4-工作流自动化">4. 工作流自动化</h3>

<p>使用代理和工具自动化复杂任务：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">ChatOpenAI</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@langchain/openai</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">createOpenAIToolsAgent</span><span class="p">,</span> <span class="nx">AgentExecutor</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">langchain/agents</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">TavilySearchResults</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@langchain/community/tools/tavily_search</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">JsonOutputParser</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@langchain/core/output_parsers</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">pull</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">langchain/hub</span><span class="dl">"</span><span class="p">;</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">researchAssistant</span><span class="p">(</span><span class="nx">topic</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 创建工具</span>
  <span class="kd">const</span> <span class="nx">tools</span> <span class="o">=</span> <span class="p">[</span>
    <span class="k">new</span> <span class="nx">TavilySearchResults</span><span class="p">({</span>
      <span class="na">maxResults</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
      <span class="na">apiKey</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TAVILY_API_KEY</span><span class="p">,</span>
    <span class="p">}),</span>
  <span class="p">];</span>
  
  <span class="c1">// 获取代理提示</span>
  <span class="kd">const</span> <span class="nx">prompt</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">pull</span><span class="p">(</span><span class="dl">"</span><span class="s2">hwchase17/openai-tools-agent</span><span class="dl">"</span><span class="p">);</span>
  
  <span class="c1">// 创建代理</span>
  <span class="kd">const</span> <span class="nx">agent</span> <span class="o">=</span> <span class="nx">createOpenAIToolsAgent</span><span class="p">({</span>
    <span class="na">llm</span><span class="p">:</span> <span class="k">new</span> <span class="nx">ChatOpenAI</span><span class="p">({</span> <span class="na">temperature</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">model</span><span class="p">:</span> <span class="dl">"</span><span class="s2">gpt-4</span><span class="dl">"</span> <span class="p">}),</span>
    <span class="nx">tools</span><span class="p">,</span>
    <span class="nx">prompt</span><span class="p">,</span>
  <span class="p">});</span>
  
  <span class="c1">// 创建执行器</span>
  <span class="kd">const</span> <span class="nx">agentExecutor</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AgentExecutor</span><span class="p">({</span>
    <span class="nx">agent</span><span class="p">,</span>
    <span class="nx">tools</span><span class="p">,</span>
    <span class="na">verbose</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="p">});</span>
  
  <span class="c1">// 执行任务</span>
  <span class="k">return</span> <span class="nx">agentExecutor</span><span class="p">.</span><span class="nx">invoke</span><span class="p">({</span>
    <span class="na">input</span><span class="p">:</span> <span class="s2">`做一份关于"</span><span class="p">${</span><span class="nx">topic</span><span class="p">}</span><span class="s2">"的详细研究报告，包括最新发展、主要挑战和未来趋势。`</span><span class="p">,</span>
  <span class="p">});</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="高级模式与最佳实践">高级模式与最佳实践</h2>

<h3 id="1-提示工程最佳实践">1. 提示工程最佳实践</h3>

<pre><code class="language-mermaid">flowchart TD
    A[提示设计原则] --&gt; B[清晰明确]
    A --&gt; C[上下文丰富]
    A --&gt; D[示例引导]
    A --&gt; E[约束限制]
    
    B --&gt; F[具体指令]
    C --&gt; G[背景信息]
    D --&gt; H[Few-Shot学习]
    E --&gt; I[输出格式]
    
    F &amp; G &amp; H &amp; I --&gt; J[高质量输出]
</code></pre>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="c1">// 使用少样本学习(Few-Shot Learning)</span>
<span class="kd">const</span> <span class="nx">fewShotTemplate</span> <span class="o">=</span> <span class="s2">`您是一位情感分析专家。分析文本情感，并分类为"积极"、"中性"或"消极"。

例子:
文本: "今天天气真好，我心情非常愉快"
情感: 积极

文本: "这家餐厅的食物质量一般"
情感: 中性

文本: "服务太差了，我再也不会来这里"
情感: 消极

文本: "{input}"
情感:`</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">fewShotPrompt</span> <span class="o">=</span> <span class="nx">PromptTemplate</span><span class="p">.</span><span class="nx">fromTemplate</span><span class="p">(</span><span class="nx">fewShotTemplate</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2-自定义链">2. 自定义链</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">BaseChain</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">langchain/chains</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">class</span> <span class="nx">CustomTranslationChain</span> <span class="kd">extends</span> <span class="nx">BaseChain</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">fields</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">llm</span> <span class="o">=</span> <span class="nx">fields</span><span class="p">.</span><span class="nx">llm</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">get</span> <span class="nx">inputKeys</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">language</span><span class="dl">"</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="kd">get</span> <span class="nx">outputKeys</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="dl">"</span><span class="s2">translation</span><span class="dl">"</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="k">async</span> <span class="nx">_call</span><span class="p">(</span><span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">language</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">values</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">prompt</span> <span class="o">=</span> <span class="s2">`将以下文本翻译成</span><span class="p">${</span><span class="nx">language</span><span class="p">}</span><span class="s2">:\n\n</span><span class="p">${</span><span class="nx">text</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">translation</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">llm</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="nx">prompt</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">{</span> <span class="nx">translation</span> <span class="p">};</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="3-批处理优化">3. 批处理优化</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="c1">// 批处理嵌入以减少API调用</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">OpenAIEmbeddings</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@langchain/openai</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">embeddings</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpenAIEmbeddings</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">texts</span> <span class="o">=</span> <span class="p">[</span><span class="dl">"</span><span class="s2">文本1</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">文本2</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">文本3</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">文本4</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">文本5</span><span class="dl">"</span><span class="p">];</span>
<span class="kd">const</span> <span class="nx">embedArray</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">embeddings</span><span class="p">.</span><span class="nx">embedDocuments</span><span class="p">(</span><span class="nx">texts</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="4-rag高级技术">4. RAG高级技术</h3>

<pre><code class="language-mermaid">flowchart TB
    A[用户查询] --&gt; B[查询重写]
    B --&gt; C[多查询生成]
    C --&gt; D[并行检索]
    D --&gt; E[结果合并]
    E --&gt; F[重排序]
    F --&gt; G[上下文构建]
    G --&gt; H[LLM生成]
    
    subgraph "检索优化"
        I[混合搜索]
        J[语义分块]
        K[元数据过滤]
    end
    
    D --&gt; I &amp; J &amp; K
</code></pre>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="c1">// 使用多查询检索增强文档搜索精度</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MultiQueryRetriever</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">langchain/retrievers/multi_query</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// 创建多查询检索器</span>
<span class="kd">const</span> <span class="nx">retriever</span> <span class="o">=</span> <span class="nx">MultiQueryRetriever</span><span class="p">.</span><span class="nx">fromLLM</span><span class="p">({</span>
  <span class="na">llm</span><span class="p">:</span> <span class="k">new</span> <span class="nx">ChatOpenAI</span><span class="p">(),</span>
  <span class="na">retriever</span><span class="p">:</span> <span class="nx">vectorStore</span><span class="p">.</span><span class="nx">asRetriever</span><span class="p">(),</span>
  <span class="na">queryCount</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="c1">// 生成3个不同的查询</span>
<span class="p">});</span>

<span class="c1">// 使用检索器</span>
<span class="kd">const</span> <span class="nx">documents</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">retriever</span><span class="p">.</span><span class="nx">getRelevantDocuments</span><span class="p">(</span><span class="dl">"</span><span class="s2">什么是量子计算？</span><span class="dl">"</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="性能优化与部署">性能优化与部署</h2>

<h3 id="1-缓存策略">1. 缓存策略</h3>

<pre><code class="language-mermaid">graph TD
    A[请求] --&gt; B{缓存检查}
    B --&gt;|命中| C[返回缓存结果]
    B --&gt;|未命中| D[LLM处理]
    D --&gt; E[存储到缓存]
    E --&gt; F[返回结果]
    
    subgraph "缓存类型"
        G[内存缓存]
        H[Redis缓存]
        I[数据库缓存]
    end
</code></pre>

<h3 id="2-流式输出">2. 流式输出</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">ChatOpenAI</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@langchain/openai</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">streamingLLM</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ChatOpenAI</span><span class="p">({</span>
  <span class="na">streaming</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">callbacks</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nx">handleLLMNewToken</span><span class="p">(</span><span class="nx">token</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">token</span><span class="p">);</span>
      <span class="p">},</span>
    <span class="p">},</span>
  <span class="p">],</span>
<span class="p">});</span>

<span class="k">await</span> <span class="nx">streamingLLM</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="dl">"</span><span class="s2">写一篇关于人工智能的文章</span><span class="dl">"</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="3-错误处理与重试">3. 错误处理与重试</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">ChatOpenAI</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@langchain/openai</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">LLMChain</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">langchain/chains</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">llmWithRetry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ChatOpenAI</span><span class="p">({</span>
  <span class="na">maxRetries</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
  <span class="na">timeout</span><span class="p">:</span> <span class="mi">30000</span><span class="p">,</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">chain</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">LLMChain</span><span class="p">({</span>
  <span class="na">llm</span><span class="p">:</span> <span class="nx">llmWithRetry</span><span class="p">,</span>
  <span class="na">prompt</span><span class="p">:</span> <span class="nx">promptTemplate</span><span class="p">,</span>
<span class="p">});</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">chain</span><span class="p">.</span><span class="nx">invoke</span><span class="p">({</span> <span class="na">input</span><span class="p">:</span> <span class="dl">"</span><span class="s2">用户输入</span><span class="dl">"</span> <span class="p">});</span>
  <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">处理失败:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
  <span class="c1">// 实现降级策略</span>
  <span class="k">return</span> <span class="dl">"</span><span class="s2">抱歉，服务暂时不可用，请稍后重试。</span><span class="dl">"</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="总结">总结</h2>

<p>LangChain 提供了一个强大的框架，使开发者能够高效地将 LLM 集成到应用程序中，并扩展其功能。主要优势包括：</p>

<ol>
  <li><strong>抽象与标准化</strong> - 统一接口简化了与不同 LLM 提供商的交互</li>
  <li><strong>组件化设计</strong> - 便于构建复杂的 AI 应用流程</li>
  <li><strong>工具和集成</strong> - 丰富的工具库和第三方集成</li>
  <li><strong>灵活性</strong> - 可以根据需求自定义和扩展组件</li>
</ol>

<p>通过合理使用 LangChain 提供的组件和模式，开发者可以构建功能强大、上下文感知的 AI 应用，大幅提升开发效率和应用质量。</p>

<p><strong>关键要点：</strong></p>
<ul>
  <li>选择合适的模型和配置参数</li>
  <li>设计有效的提示模板</li>
  <li>合理使用记忆和上下文管理</li>
  <li>利用RAG技术增强知识获取</li>
  <li>通过代理和工具扩展LLM能力</li>
  <li>注重性能优化和错误处理</li>
</ul>

<p>随着LLM技术的不断发展，LangChain也在持续演进，为开发者提供更多强大的功能和工具，助力构建下一代智能应用。</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#ai%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91" class="page__taxonomy-item" rel="tag">AI应用开发</a><span class="sep">, </span>
    
      <a href="/tags/#langchain" class="page__taxonomy-item" rel="tag">LangChain</a><span class="sep">, </span>
    
      <a href="/tags/#llm" class="page__taxonomy-item" rel="tag">LLM</a><span class="sep">, </span>
    
      <a href="/tags/#%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B" class="page__taxonomy-item" rel="tag">大语言模型</a><span class="sep">, </span>
    
      <a href="/tags/#%E6%8F%90%E7%A4%BA%E5%B7%A5%E7%A8%8B" class="page__taxonomy-item" rel="tag">提示工程</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#ai-technology" class="page__taxonomy-item" rel="tag">AI-Technology</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2024-12-28T00:00:00+08:00">December 28, 2024</time></p>


      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=LangChain+%E4%B8%8E+LLM+%E7%9A%84%E7%BB%93%E5%90%88%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3%20http%3A%2F%2F0.0.0.0%3A4000%2Fai-technology%2Flangchain-llm-integration-guide%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2F0.0.0.0%3A4000%2Fai-technology%2Flangchain-llm-integration-guide%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2F0.0.0.0%3A4000%2Fai-technology%2Flangchain-llm-integration-guide%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/ai-technology/langchain-graph-knowledge-construction/" class="pagination--pager" title="LangChain Graph 详解：构建智能知识图谱
">Previous</a>
    
    
      <a href="#" class="pagination--pager disabled">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/langchain-graph-teaser.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ai-technology/langchain-graph-knowledge-construction/" rel="permalink">LangChain Graph 详解：构建智能知识图谱
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2024-12-27T00:00:00+08:00">December 27, 2024</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          6 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">深入探讨LangChain Graph的概念、工作原理、应用场景以及实践技巧，帮助您全面理解和应用这一强大的知识图谱构建工具。
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/agent-systems-teaser.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ai-technology/agent-systems/realtime-agent-systems-evolution/" rel="permalink">实时Agent系统技术演进与应用前景
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2024-12-26T10:00:00+08:00">December 26, 2024</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">深度解析实时Agent系统的技术架构、核心原理、行业应用场景以及未来发展趋势，探讨人机协同的新范式
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/ai-voice-call-teaser.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ai-technology/voice-communication/github-pages-setup-guide/" rel="permalink">AI语音通话系统开发实战：从零构建智能语音交互平台
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2024-01-05T00:00:00+08:00">January 5, 2024</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">深入探讨如何构建一个完整的AI语音通话系统，涵盖WebRTC实时通信、语音识别、自然语言处理和语音合成等核心技术。
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/blog/introduction/welcome-to-my-blog/" rel="permalink">欢迎来到我的博客
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2024-01-01T10:00:00+08:00">January 1, 2024</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          less than 1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">欢迎来到我的个人博客

</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://github.com/chicogong" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="mailto:chicogong@tencent.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 Chico Gong. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
